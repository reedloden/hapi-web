<html>
<head>
<title>hAPI test</title>
<script type="application/javascript" src="js/md5.js"></script>
<script type="application/javascript;version=1.7" src="js/hapi.js"></script>
<script>
  var hapi = new hAPI();

  function reallyMakeRequest(aStatus) {
    if (!hapi.authenticated) {
      alert("Authentication error: " + uneval(aStatus));
      return;
    }

    if (document.getElementById("auth"))
      document.body.removeChild(document.getElementById("auth"));

    var method = document.getElementById("method").value;
    var params = JSON.parse(document.getElementById("params").value);
    hapi.request(method, params, function(result, status) {
      document.getElementById("laststatus").textContent = uneval(status);
      document.getElementById("result").value = uneval(result);
    });
  }

  function makeRequest() {
    if (!hapi.authenticated)
      this.hapi.authenticate(document.getElementById("name").value,
                             document.getElementById("pass").value,
                             reallyMakeRequest);
    else
      reallyMakeRequest();
  }
</script>
</head>
<body>
  <div id="auth">
    <label for="name">Username:</label>

    <input id="name" type="text"/>
    <label for="pass">Password:</label>
    <input id="pass" type="password"/>
  </div>
  <div>
  <label for="method">Method:</label>
  <input id="method" type="text"/>
  <label for="params">Parameters (as JSON object):</label>

  <input id="params" type="text" value="{}"/>
  </div>
  <button onclick="makeRequest()">Go!</button>
  <br>
  <textarea id="result" rows="30" cols="100"></textarea>
  <div>Last status: <span id="laststatus"></span></div>
  <script>
    if (hapi.authenticated)
      document.body.removeChild(document.getElementById("auth"));
  </script>
</body>
</html>
